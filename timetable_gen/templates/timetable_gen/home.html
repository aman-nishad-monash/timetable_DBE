{% extends "timetable_gen/base.html" %}

{% block content %}
  <!-- CSV File Upload Form -->
  <form id="timetableForm" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="drop-zone" id="dropZone">
      <span class="drop-zone__prompt">üìÅ Drop CSV file here or click to upload</span>
      <input type="file" name="file" class="drop-zone__input" accept=".csv" required>
      <button type="submit">Submit</button>
    </div>
    <div id="fileList"></div>
  </form>

<!-- Preferences Form -->
<form method="post" id="preferencesForm">
  {% csrf_token %}

  <!-- Render dynamic lecturers field if it exists -->
  {% if form.fields.lecturers %}
    <div class="lecturers-section">
      <h3>Select Lecturers</h3>
      {{ form.lecturers }}
    </div>
  {% endif %}

  <!-- Time Inputs -->
  <div class="time-picker-group">
    <div class="preference-group">
      <label for="{{ form.preferred_start_time.id_for_label }}">{{ form.preferred_start_time.label }}</label>
      {{ form.preferred_start_time }}
    </div>
    <div class="preference-group">
      <label for="{{ form.preferred_end_time.id_for_label }}">{{ form.preferred_end_time.label }}</label>
      {{ form.preferred_end_time }}
    </div>
  </div>

  <!-- Days Off -->
  <div class="preference-group">
    <label for="{{ form.days_off.id_for_label }}">{{ form.days_off.label }}</label>
    {{ form.days_off }}
  </div>

  <!-- Render dynamic unit ranking fields -->
  {% for field in form %}
    {% if field.name|slice:":10" == "unit_rank_" %}

  <div class="input-group">
        <label for="{{ field.id_for_label }}">{{ field.label }}</label>
        {{ field }}
      </div>
    {% endif %}
  {% endfor %}

  <!-- Busy Schedule -->
  <div class="preference-group">
    <label>{{ form.busy_sched }} {{ form.busy_sched.label }}</label>
  </div>

  <!-- Critical Features and Preference Order Sections -->
  <div class="preference-group">
    <h3>Critical Preferences</h3>
    {% for field in form %}
      {% if field.name|slice:":8" == "critical" %}
        <div class="critical-item">
          <label>{{ field }} {{ field.label }}</label>
        </div>
      {% endif %}
    {% endfor %}
  </div>

  <div class="preference-group">
    <h3>Preference Priority Order</h3>
    {% for field in form %}
      {% if field.name|slice:":16" == "preference_order" %}
        <div class="order-item">
          <label>{{ field }} {{ field.label }}</label>
        </div>
      {% endif %}
    {% endfor %}
  </div>

  <button type="submit" name="action" value="save_preferences" class="save-button">
    Generate Timetable
  </button>
</form>
{% endblock %}
